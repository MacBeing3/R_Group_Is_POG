---
title: "project"
author: "DawsonMacLean"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## CATAN

### Intro

  what is Catan, where we got our data

  goal: compare descriptive trends in the Catan data with what a randomforest model predicts what are most important factors

  "LIE" : using just descriptive

  "TRUTH": using randomforest model as a more reliable way to show what is actually important. While also knowing that it is incomplete


## Modifying Data
we wanted to add color as a random variable that *should* have no effect, as we are generating it randomly

```{r Data Manipulation}
# Reading in Catan data from data folder
CatanData <- read.csv(file = 'data/catanstats.csv', header = TRUE)

set.seed(333)
# Creating object that has all of the desired colors
colors <- c("red", "blue", "white", "orange")

#applies all 4 colors per game with no repeats
CatanData$color <- unlist(
  lapply(
    split(CatanData, CatanData$gameNum),
    function(group)
    sample(colors))
  )



```




Here we are gonna train a randomforest model thingy based on our 50 games. This allows us to compare descriptive information (graphs) with the randomforest model to determine predictors of winning

Dawson can write most/all of this ^^

```{r do_game,echo=TRUE,warning=FALSE,message=FALSE}
#,message=FALSE



source("./simulatingCatan.R")

#to give the stats n plot for a Catan game, just enter a dataset of 4-player x 50 games (like the original)


predictCatan(CatanData,rf_model)

#predictCatanPlayer(player, rfmodel)

```

Here are the "importance" values for the rf_model. To simplify, this refers to how important a variable is in predicting the likelihood of winning

Dawson can write most/all of this ^^

```{r importance}

print(importance(rf_model))

print(trainCatanModel)

print(predictCatan)

print(predictCatanPlayer)


```

## Descriptive Data Graphs

Here are graphs showing descriptive characteritics of the oringal CatanData dataset.  


```{r graphs,echo=TRUE,warning=FALSE,message=FALSE}

#determining winner based on the first player to have >=10 points
CatanData$winloss <- rep("Loss", nrow(CatanData))

for (game in unique(CatanData$gameNum)) {
    
    maybe_win <- CatanData$player[CatanData$points >= 10 & CatanData$gameNum == game]
    
    if (length(maybe_win) > 0) {
      CatanData$winloss[((game - 1) * 4) + min(maybe_win)] <- "Win"
    }
  }

library(tidyverse)

library(ggplot2)

##win rate by player turn 

wins_only <- CatanData %>%
  filter(winloss == "Win")

win_rate_player <- CatanData %>%
  group_by(player) %>%
  summarise(
    total = n(),
    wins = sum(winloss == "Win"),
    win_rate = wins / total
  )

ggplot(win_rate_player, aes(x = factor(player), y = win_rate, fill = factor(player))) +
  geom_col() +
  labs(title = "Win Rate by Turn Position",
       x = "Turn Position (Player)",
       y = "Win Rate",
       fill = "Player") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal()

##win rate by color 
win_rate_color <- CatanData %>%
  group_by(color) %>%
  summarise(
    total = n(),
    wins = sum(winloss == "Win"),
    win_rate = wins / total
  )

ggplot(win_rate_color, aes(x = color, y = win_rate, fill = color)) +
  geom_col() +  # Use 'geom_col' to create a bar plot
  scale_fill_manual(values = c("royalblue2", "darkgoldenrod1", "brown2", "snow2")) +  # Assign custom colors to each bar
  scale_y_continuous(labels = scales::percent_format()) +
  labs(title = "Win Rate by Color",
       x = "Color",
       y = "Win Rate") +
  theme_minimal()

##win rate resource
Catan_long <- CatanData %>%
  pivot_longer(
    cols = matches("settlenum|settlersc"),
    names_to = c("settlement", ".value"),
    names_pattern = "(\\dsettle)(num\\d|rsc\\d)"
  ) %>%
  rename(number = num1, resource = rsc1)  # fix names for consistency

Catan_long <- Catan_long %>%
  mutate(
    number = as.numeric(number),
    resource = str_trim(resource),
    resource = ifelse(str_detect(resource, "^[A-Z]$"), resource, NA)
  ) %>%
  drop_na(number, resource)

win_rate_resource <- Catan_long %>%
  group_by(resource) %>%
  summarise(
    total = n(),
    wins = sum(winloss == "Win"),
    win_rate = wins / total
  )

label_map <- c("L" = "Lumber", "C" = "Clay", "S" = "Sheep", "W" = "Wheat", "O" = "Ore")

# Generate the plot
ggplot(win_rate_resource, aes(x = resource, y = win_rate, fill = resource)) +
  geom_col() +
  scale_fill_manual(values = c("L" = "forestgreen",    # Lumber (L) = Green
                               "C" = "chocolate",   # Clay (C) = Brown
                               "S" = "darkolivegreen2",       # Sheep (S) = Blue
                               "W" = "goldenrod1",     # Wheat (W) = Yellow
                               "O" = "cadetblue4")) +       # Ore (O) = Gray
  scale_y_continuous(labels = scales::percent_format()) +
  scale_x_discrete(labels = label_map) +  # Replace abbreviations with full names
  labs(title = "Win Rate by Starting Resource",
       x = "Resource",
       y = "Win Rate") +
  theme_minimal()









```

## Bootstrap?

do we source the bootstrap file or is that kinda too much stuff at this point


## Conclusions

### Conclusions based on Graphs

  player 2 is the best, I think wheat is the best not sure  
  
  just describe what the plots would suggest is important
  
  
  
### Conclusions based on RandomForest

  probaly will put up the importance chart thing again
  
  explain what it probably means
  
  
  
### Differences

  explain what is different quickly
  
  
  probably will put in a short predictCatanPlayer() thing where we will only differ the color, to show how that compares with the graphs
  
  any difference with color being significant should mean nothing
  
  
## yippee we done

short goodbe conclusion
  
  

